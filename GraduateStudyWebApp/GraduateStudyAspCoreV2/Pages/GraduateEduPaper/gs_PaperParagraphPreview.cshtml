@page
@{
    Layout = "~/Pages/Shared/_Layout_PC.cshtml";
    ViewData["Title"] = "论文段落表维护";
}
@section Styles{
    @*<script src="http://www.jq22.com/jquery/1.11.1/jquery.min.js"></script>*@
    @*<script src="~/lib/zoomify/zoomify.min.js"></script>*@
    <link rel="stylesheet" href="../lib/bootstrap/dist/css/bootstrap.css" />

    <link rel="stylesheet" href="~/lib/Xadmin/css/font.css">
    <link rel="stylesheet" href="~/lib/Xadmin/css/xadmin.css">
    <!-- 树形菜单样式 。js -->
    <script type="text/javascript" src="../lib/jquery-1.6.min.js"></script>

    <link rel="stylesheet" type="text/css" href="../css/SimpleTree.css">
    <link rel="stylesheet" href="~/css/public.css" />
    <!-- 树形样式-->

    <script type='text/javascript' src='~/textboxio/textboxio.js'></script>
    <link rel="stylesheet" type="text/css" href="~/textboxio/example.css" />
    @*<link rel="stylesheet" type="text/css" href="~/lib/Xadmin/lib/layui/css/layui.css">*@
    @*<link rel="stylesheet" type="text/css" href="~/lib/layui/css/layui.css">*@

    <style type="text/css">
        ul > li {
            list-style: none;
        }
        /* 可展开*/
        .switch-open {
            margin-left: 10px;
            border: 6px solid transparent;
            display: inline-block;
            width: 0px;
            height: 0px;
            border-top-color: black;
            float: left;
        }
        /* 展开完毕*/
        .switch-close {
            margin-left: 10px;
            border: 6px solid transparent;
            display: inline-block;
            width: 0px;
            height: 0px;
            border-left-color: black;
            margin-bottom: 2px;
            float: left;
        }
        /* 改变CheckBox样式*/
        input[type='checkbox'] {
            width: 20px;
            height: 20px;
            -webkit-appearance: none;
            -moz-appearance: none;
            border: 1px solid #c9c9c9;
            border-radius: 3px;
            outline: none;
            color: white;
            text-align: center;
        }

            input[type='checkbox']:before {
                content: '√ ';
                color: transparent;
            }

        input[type=checkbox]:checked {
            background-color: #30add6;
        }

            input[type=checkbox]:checked:before {
                content: '√';
                color: white;
                font-weight: bold;
            }
    </style>
    <style>

        #divTree a {
            font-size: 18px;
        }

        .submenu {
            margin-left: 35px;
        }
        /*主题小标题*/
        .title {
            font-size: 18px;
        }

        /*主题内容*/
        .artlist {
            font-size: 16px;
        }

        .example img {
            max-width: 200px;
            margin-left: 10px;
        }

        #divContent_list {
            height: 100%;
            width: 100%;
        }

        #PaperPreview tr td {
            border-top: #FF0000 solid 0px;
            /*width: 50%;
            background-color: #00CC33;*/
            text-align: center;
            line-height: 24px;
        }
    </style>

}
@section Scripts{
    @*<script src="~/layui/layui.js" charset="utf-8"></script>*@

    <script src="~/lib/Xadmin/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="~/lib/Xadmin/js/xadmin.js"></script>

    <!-- 评论评分 -->
    @*<script src="~/lib/startnum-1.0/starnum.js" type="text/javascript" charset="utf-8"></script>*@

    @*<script src="~/lib/zoomify/zooming.js"></script>*@

    <script src="~/lib/FileSaver.js"></script>
    <script src="~/lib/jquery.wordexport.js"></script>

    <script src="~/lib/require/require.js" data-main="../js/src/config"></script>


}

<script>
//所有用户自定义的JS函数建议都放在这里
    function GetRequest() {
        var url = location.search; //获取url中"?"符后的字串
        var theRequest = new Object();
        if (url.indexOf("?") != -1) {
            var str = url.substr(1);
            strs = str.split("&");
            for (var i = 0; i < strs.length; i++) {
                theRequest[strs[i].split("=")[0]] = unescape(strs[i].split("=")[1]);
            }
        }
        return theRequest;
    }
    function GetParagraphByPaperID() {
        var Request = new Object();
        Request = GetRequest();
        var str1;
        str1 = Request['PaperId'];

        var str2;
        str2 = Request['TopicId'];

        if (str1 != null) {
            $('#hidPaperId').val(str1);
            $('#hidTopicId').val(str2);
            require(["../js/GraduateEduPaper/gs_PaperParagraphPreview.js"], function (section) {
                var objPage = new section.gs_PaperParagraphPreview();
                objPage.Page_Load();
            });

        }
        else {
            require(["../js/GraduateEduPaper/gs_PaperParagraphPreview.js"], function (section) {
                var objPage = new section.gs_PaperParagraphPreview();
                objPage.Page_Load();
            });

        }
    }


    /*
  页面导入-在导入页面后运行的函数
 (AutoGCLib.WA_ViewScript_TS4CSharp:Gen_WApi_JS_Page_Load)
 */
    window.onload = function () {
        GetParagraphByPaperID();

    }

  
    jQuery(document).ready(function ($) {

        var btn = document.getElementById('btn')
        var Preview = $("#PaperPreview").attr("id")
        if (!!window.ActiveXObject || "ActiveXObject" in window) {

            $("#btnExportWord").onclick = function () {
                var Preview = $("#PaperPreview").attr("id")
                //AllAreaWordTwo(document.getElementById('test'), '^')
                AllAreaWordTwo(Preview, '^')
            }
        } else {
            $("#btnExportWord").click(function () {

                $("#PaperPreview").wordExport("数据导出");

            });

            //$("#btnExportWord").onclick = function () {
            //    $("#PaperPreview").wordExport("论文预览");
            //}
        }
    });
    //指定页面区域内容导入Word
    function AllAreaWord() {
     //   $("#PaperPreview").wordExport();

       // var oWD;

       // //判断浏览器是否支持ActiveX控件

       // if(window.ActiveXObject){

       //     //支持-通过ActiveXObject的一个新实例来创建XMLHttpRequest对象
       //     oWD = new ActiveXObject("Word.Application");
       //     //oWD = new ActiveXObject("Microsoft.XMLHTTP");

       // }

       //     //不支持

       // else if(window.XMLHttpRequest){

       //     oWD = new XMLHttpRequest()

       // }


       // //得到控件ID
       // var Preview = $("#PaperPreview").attr("id")
       //// var oWD = new ActiveXObject("Word.Application");
       // var oDC = oWD.Documents.Add("", 0, 1);
       // var orange = oDC.Range(0, 1);
       // var sel = document.body.createTextRange();
       // sel.moveToElementText(Preview);
       // sel.select();
       // sel.execCommand("Copy");
       // orange.Paste();
       // oWD.Application.Visible = true;
        //window.close();

        var btn = document.getElementById('btn')
        var Preview = $("#PaperPreview").attr("id")
        if (!!window.ActiveXObject || "ActiveXObject" in window) {

            $("#btnExportWord").onclick = function () {
            var Preview = $("#PaperPreview").attr("id")
            //AllAreaWordTwo(document.getElementById('test'), '^')
            AllAreaWordTwo(Preview, '^')
             }
        } else {
            $("#btnExportWord").onclick = function () {
            $("#PaperPreview").wordExport("论文预览");
               }
        }


    }


    //  {Object} cont  要导出的html元素内容的id,注意不要加双引号@param {Object} key   分页关键字
    function AllAreaWordTwo(cont, key) {
        var oWD = new ActiveXObject("Word.Application");
        //默认为页面视图
        var oDC = oWD.Documents.Add("", 0, 0);
        var oRange = oDC.Range(0, 1);
        //var oRange1 = oDC.Range(0,2);
        var sel = document.body.createTextRange();
        //参数为html元素id
        sel.moveToElementText(cont);
        sel.select();
        sel.execCommand("Copy");
        oRange.Paste();
        oWD.Application.Visible = true;
        ////得到打开后word的selection对象
        //var selection = oWD.Selection;
        ////设置字体大小
        //selection.Font.Size = 10;
        ////ctrl+A 全选操作
        //selection.WholeStory();
        ////清除格式
        //selection.Find.ClearFormatting();
        ////指定查找关键字
        //selection.Find.Text = key;
        ////^m为手动分页符标注
        ////向下查找
        //selection.Find.Forward = true;
        //selection.Find.Wrap = 1;
        ////不区分大小写
        //selection.Find.MatchCase = false;
        ////不匹配整个单词
        //selection.Find.MatchWholeWord = false;
        ////如果找到指定字符串返回真,否则返回false
        //while (selection.Find.Execute()) {
        //    //插入分页符,分页符常量为7,具体可查word api
        //    selection.InsertBreak(7);
        //}
    }



    function ParagraphCheck() {
        xadmin.open('段落检查测试', '../GraduateEduPaper/TestParaghCheck', '', '', true)
    }

    function btnAddArrayByString() {
        var strText = '<span style="color:red;"><p>测试<span style="color:blue">一</span></p>大<span style="color:blue">段数据</span>不同小小的颜色<span style="color:blue">显示</span></span>';
      //  var Textstr = '<span style="color:red;"><p>测试<span style="color:blue">一</span></p>大<span style="color:blue">段数据</span>不同<span style="color:red;">小小</span><span style="color:blue">的颜色显示</span></span>';
        require(["../js/GraduateEduPaper/gs_PaperParagraphPreview.js"], function (papersubviewpoint) {

            var objPage = new papersubviewpoint.gs_PaperParagraphPreview();
            objPage.SaveObjListByString(strText);
        });
    }
</script>

@*<SCRIPT LANGUAGE="JavaScript">

        jQuery(document).ready(function ($) {

         var sel = document.selection;
         if (sel != null)
         {
             var rng = sel.createRange();
             if (rng != null)
                 rng.pasteHTML("<font color=red>插入的文字</font>");
         }
     }) //-->
    </SCRIPT>*@
<div id="divLoading" class="loading">
    <img src="~/images/CirclePoint.gif" />
</div>
<div id="tabLayout" class="tab_layout">

    @*-- 标题层 --*@
    <div class="x-nav">
        <span class="layui-breadcrumb">
            <a href="">首页</a>
            <a href="">主题研究管理</a>
            <a>
                <cite>论文预览</cite>
            </a>
            <Label id="lblMsg_List" name="lblMsg_List"></Label>
        </span>
        <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
            <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
        </a>
        <button style="line-height:1.6em;margin-top:3px;float:right" class="layui-btn layui-btn-small" id="btnExportWord" name="btnExportWord" title="导出word">导出word</button>
        @*<button style="line-height:1.6em;margin-top:3px;float:right" class="layui-btn layui-btn-small" id="btnParagraphcheck" name="btnParagraphcheck" title="段落比较测试" onclick="ParagraphCheck()">段落比较测试</button>
            <button id="clkArrData" onclick="btnAddArrayByString();">对象列表数据存放测试</button>*@
    </div>


    <div id="divContent_list">

        <div id="PaperPreview" class="layui-fluid">
            @*<div id="div_PaperParagraphList" class="layui-fluid">*@
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-body ">
                            @*<table id="PaperPreview" class="layui-table layui-form" style="border:none;">
                                   <thead style="text-align:center;">
                                       <tr style="text-align:center;">
                                           <th style="text-align:center;"><div style="text-align:center;"><h2><Label id="lblPaperTitle" name="lblPaperTitle"></Label></h2></div></th>
                                       </tr>
                                       <tr id="firstgarapht">

                                       </tr>
                                   </thead>
                                       <tbody id="tbList" class="x-cate"></tbody>
                                </table>*@

                            <div style="text-align:center;"><h2><Label id="lblPaperTitle" name="lblPaperTitle"></Label></h2></div>
                            <div id="firstgarapht"></div>
                            <div id="tbList"></div>
                            @*<table id="PaperPreview" class="layui-table layui-form" style="border:none;">
                                    <thead style="text-align:center;">
                                        <tr style="text-align:center;">
                                            <th style="text-align:center;"></th>
                                        </tr>
                                        <tr id="firstgarapht"></tr>
                                    </thead>
                                    <tbody id="tbList" class="x-cate"></tbody>
                                </table>*@





                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>
@* 论文Id *@
<input id="hidPaperId" type="hidden" />
@* 段落排序 *@
<input id="hidSortvgs_PaperParagraphBy" type="hidden" />

<input id="hidTopicId" type="hidden" />
