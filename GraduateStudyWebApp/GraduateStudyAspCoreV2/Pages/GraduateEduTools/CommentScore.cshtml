@page
@{

    Layout = "~/Pages/Shared/_Layout_PC.cshtml";
    ViewData["Title"] = "总评打分";
    //请参见页尾的隐形控件hidUserid和hidUserId1的使用。
}
@section Styles{

    @*<link rel="stylesheet" href="../css/Bootstrap-3.0.3.css" />*@
    <link rel="stylesheet" href="../lib/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="../css/site.css" />

    <link rel="stylesheet" href="~/lib/Xadmin/css/font.css">
    <link rel="stylesheet" href="~/lib/Xadmin/css/xadmin.css">

    <!-- 树形菜单样式 。js -->
    <script type="text/javascript" src="../lib/jquery-1.6.min.js"></script>
    <link rel="stylesheet" href="~/css/comment.css">
    <link rel="stylesheet" type="text/css" href="../css/SimpleTree.css">
    <link rel="stylesheet" href="~/css/public.css" />

    <style>
        .nav-tabs .nav-link.active, .nav-tabs .nav-item.show .nav-link {
            color: #0080ff;
            background-color: #fff;
            border-color: #dee2e6 #dee2e6 #fff;
            font-weight: bold;
        }

        /* 菜单项 */
        /*.st_tree ul li {
            padding-left: 30px;
            text-align: left;
            font-size: 13px;
            color: #222;
            line-height: 18px;
            cursor: pointer;
            list-style: none;
            background: url(../images/st_node.gif);
            background-repeat: no-repeat;
            padding: 0 0 3px 20px;
        }*/

        .divTree2 {
            position: fixed;
            top: 45px;
            left: 10px;
            /* bottom: 5%; */
            z-index: 999;
        }

        li {
            line-height: 30px;
            text-align: left;
        }
        .layui-table td, .layui-table th {
             min-width: 50px; 
        }
    </style>

}
@section Scripts{
    <script src="../lib/jquery/dist/jquery.js"></script>
    <script src="~/lib/Xadmin/lib/layui/layui.js" charset="utf-8"></script>
    <script type="text/javascript" src="~/lib/Xadmin/js/xadmin.js"></script>
    <script src="../lib/bootstrap/dist/js/bootstrap.js"></script>

    <script>
        layui.use(['laydate', 'form'],
            function () {
                var laydate = layui.laydate;

                //执行一个laydate实例
                laydate.render({
                    elem: '#txtUpdDate_q' //指定元素
                });

            });
    </script>
    <script src="../lib/require/require.js" data-main="../js/src/config"></script>

}

<script>

    window.onload = function () {
        $("#hidTabNum").val(1);
        require(["../js/GraduateEduTools/CommentScore.js"], function (paper) {
            var objPage = new paper.CommentScore();
            objPage.Page_Load();
        });
    }
    //点击tab选项卡事件 KeyId 判断不同的调用
    function li_QaCommentScore_Click(KeyId) {
        //存储点击的id
        $("#hidTabNum").val(KeyId);
        require(["../js/GraduateEduTools/CommentScore.js"], function (paper) {
            var objPage = new paper.CommentScore();
            objPage.li_QaCommentScore_Click();
        });
    }
    //点击树菜单事件；
    function btnSelectPaper(strKeyId, id_CurrEduCls, strStuName) {
        //先清除背景色
        $("#TreeBind li a").removeClass("selected");
        //添加背景色
        $("#" + strKeyId + " a").addClass("selected");
        //存储点击的id
        $("#hidStuId").val(strKeyId);
        //存放显示用户名；
        $("#spUserName").html(strStuName);

        
        $("#hidid_CurrEduCls").val(id_CurrEduCls);

        //点击后调整关系表数据方法；
        require(["../js/GraduateEduTools/CommentScore.js"], function (paper) {
            var objPage = new paper.CommentScore();
            objPage.li_QaCommentScore_Click();
        });
    }

    //讨论打分 ---- 评价打分
    function BtnAddOrUpdateScoreSummary_Click(strUserId, strId_CurrEducls, strScoreTypeId) {


        //$('#hidPaperGroupId').val(strKey);
        //$('#txtPaperGroupName').val(PaperGroupName);
        $('#btnEditGroup').html("确认");

        //点击后调整关系表数据方法；
        require(["../js/GraduateEduTools/CommentScore.js"], function (paper) {
            var objPage = new paper.CommentScore();
            objPage.BtnAddOrUpdateScoreSummary_Click(strUserId, strId_CurrEducls, strScoreTypeId);
        });
        ShowDialogOne();

    }
    //提交数据  讨论 和 评价

    function BtnSubmitScoreSummary_Click(strUserId, strId_CurrEducls, strScoreTypeId) {


        //$('#hidPaperGroupId').val(strKey);
        //$('#txtPaperGroupName').val(PaperGroupName);
        if (confirm("确定提交吗？提交后打分不可修改")) {
            //点击后调整关系表数据方法；
            require(["../js/GraduateEduTools/CommentScore.js"], function (paper) {
                var objPage = new paper.CommentScore();
                objPage.BtnSubmitScoreSummary_Click(strUserId, strId_CurrEducls, strScoreTypeId);
            });
            return true;
        }
        return false;

    }




    //打分提交
    function SubmitScore_Click() {
        var retNum = /^\d*$/;//匹配数字
        //提示文本框不能为空
        if($("#txtScoreName").val() == ""){
            layer.msg('打分不能为空不能为空!', {
                icon: 3,
                time: 1000
            });
        }
        else if (retNum.test($("#txtScoreName").val())) {

            HideDialogOne();
            require(["../js/GraduateEduTools/CommentScore.js"], function (paper) {
                var objPage = new paper.CommentScore();
                objPage.SubmitScore_Click();
            });
        }
        else {
            layer.msg('请输入数字!', {
                icon: 3,
                time: 1000
            });
        }




    }

    /*
显示对话框
(AutoGCLib.WA_ViewScript_TS4CSharp:Gen_WApi_JS_ShowDialog)
*/
    function ShowDialogOne() {
        require(['jquery', 'bootstrap'], function ($) {
            $('#editGroup').modal('show');
        });
    }

    /*
隐藏对话框
(AutoGCLib.WA_ViewScript_TS4CSharp:Gen_WApi_JS_HideDialog)
*/
    function HideDialogOne() {
        require(['jquery', 'bootstrap'], function ($) {
            $('#editGroup').modal('hide');
        });
    }
    //信息提示
    function layui_Alert(iconKey, strMsg) {

        layer.msg(strMsg, {
            icon: iconKey,
            time: 2000
        });
    }

</script>

<div id="divLoading" class="loading">
    <img src="~/images/CirclePoint.gif" />
</div>
<a id="backtop" class="back-top" href="javascript:scroll(0,0);" target="_self" title="返回顶部" style="display: block;">
    <i class="icon-backtop"></i>
</a>
<div id="tabLayout" class="tab_layout">
    @*-- 标题层 --*@
    <div class="x-nav">
        <span class="layui-breadcrumb">
            <a href="">首页</a>
            <a href="">评论管理</a>
            <a>
                <cite>
                    <span id="lbltitle" name="lbltitle">总评打分</span>
                </cite>
            </a>
            <Label id="lblMsg_List" name="lblMsg_List"></Label>
        </span>

        <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
            <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
        </a>

    </div>


    <div style="margin:5px;">
        <div id="divTree" class="divTree divTree2" style="width:32%; overflow-x:auto;">
            @*<div id="divFunction" class="layui-card-header">
            <div style="float:left;">
                您关注的论文有:

            </div>

            <div style="float:right;" class="btn-group btn-group-sm">
                <button class="btn btn-success" id="btnAddNewRecord" name="btnAddNewRecord" title="添加组" onclick="btnAddNewRecord_Click()"><i class="layui-icon">&#xe654;</i></button>

                <button class="btn btn-danger" id="btnDelRecord" name="btnDelRecord" title="取消关注" onclick="btnDelRecord_Click()"><i class="layui-icon">&#xe640;</i>取消关注</button>
            </div>

            <div style="float:right;margin-right:50px;">
                <input type="checkbox" id="ckbMyResearch" onclick="ckbMyResearch_Click(this)">我的研究
            </div>
        </div>*@
            @*<ul class="st_tree" id="TreeBind"></ul>*@

            <table class="layui-table layui-form">
                <thead>
                    <tr>
                        <th style="width:5%;">姓名</th>
                        <th style="width:5%;">讨论<br />名次</th>
                        <th style="width:10%;">讨论<br />数/(分)</th>
                        <th style="width:15%;">讨论<br />日期</th>
                        <th style="width:5%;">评价<br />名次</th>
                        <th style="width:10%;">评价<br />数/(分)</th>
                        <th style="width:15%;">评价<br />日期</th>
                        <th style="width:5%;">标记<br />名次</th>
                        <th style="width:10%;">标记<br />数/(分)</th>
                        <th style="width:15%;">标记<br />日期</th>
                    </tr>
                </thead>
                <tbody id="TreeBind" class="x-cate"></tbody>
            </table>

        </div>

        <div id="divContent" class="divContent divContent2" style="width:66%;">
            <div class="alert alert-info alert-dismissible">
                <button type="button" class="close" data-dismiss="alert">&times;</button>
                <strong>本界面功能：</strong>左侧显示教学班评价学生，点击后右侧显示相关评价。可以对该学生打分，点击提交按钮后，打分则不可以修改。
            </div>
            <ul class="nav nav-tabs" role="tablist">
                <li class="nav-item">
                    <a class="nav-link active" data-toggle="tab" href="#Paper_SubViewpoint" onclick="li_QaCommentScore_Click(1)">讨论打分</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#SysComment" onclick="li_QaCommentScore_Click(2)">评价打分</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" data-toggle="tab" href="#Paper_Tags" onclick="li_QaCommentScore_Click(3)">标记打分</a>
                </li>
                @* <li class="nav-item">
            <a class="nav-link" data-toggle="tab" href="#Tea_QA" onclick="li_PaperAttentionTab_Click(4)">教师提问</a>
        </li>*@
            </ul>

            <!-- Tab panes -->
            <div class="tab-content">

                <div class="alert alert-dismissible" style="margin-bottom:-15px;">

                    <strong>被打分人：</strong><span id="spUserName"></span>
                </div>
                <div id="Paper_SubViewpoint" class="tab-pane active">

                    @* 查询区 *@
                    @*<div id="divQuery" class="div_query">

                <table id="tabQuery" name="tabQuery" style="width: 20%; " class="table table-bordered table-hover table td table-sm">
                    <tr>
                        <td>
                            <select id="ddlSubViewpointTypeId_q" name="ddlSubViewpointTypeId_q" class="form-control" style="width:200px;" />
                        </td>
                        <td>
                            <select id="ddlSectionId_q" name="ddlSectionId_q" class="form-control" style="width:200px;" />
                        </td>
                        <td>
                            <button title="查询" class="layui-btn" lay-submit="" lay-filter="sreach" onclick="btnQuery_Click()">
                                <i class="layui-icon">&#xe615;</i>
                            </button>
                        </td>

                    </tr>
                </table>
            </div>*@
                    @*-- 功能区 --*@
                    @*<div id="div_SubViewpointList" class="layui-fluid">*@
                    <div id="QA_Answer">
                        <div class="layui-row layui-col-space15">
                            <div class="layui-col-md12">
                                <div class="layui-card">
                                    <div class="layui-card-body ">
                                        <table class="layui-table layui-form">
                                            @*<thead>
                                    <tr>*@
                                            @*<th width="5">
                                        <input type="checkbox" name="" lay-skin="primary">
                                    </th>*@
                                            @*<th width="30">标识</th>*@
                                            @*<td width="100">论文节</td>*@
                                            @*<th>观点内容</th>*@
                                            @*<th width="90" style="text-align:center">排序</th>*@
                                            @*<th width="100">编写用户</th>*@
                                            @*<th width="110">编写时间</th>*@
                                            @*<th width="100">操作</th>*@
                                            @*</thead>*@
                                            <tbody id="tbList" class="x-cate"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>

                <div id="SysComment" class="tab-pane fade">
                    <div class="layui-row layui-col-space15">
                        <div class="layui-col-md12">
                            <div class="layui-card">
                                <div class="layui-card-body ">
                                    <table class="layui-table layui-form">

                                        <tbody id="tbCommentList" class="x-cate"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="Paper_Tags" class="tab-pane fade">
                    <div class="layui-row layui-col-space15">
                        <div class="layui-col-md12">
                            <div class="layui-card">
                                <div class="layui-card-body ">
                                    <table class="layui-table layui-form">

                                        <tbody id="tbTagsList" class="x-cate"></tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                @*<div id="Tea_QA" class="tab-pane fade">
            <div class="divComment" style="margin:10px;">
                <div class="comment-short" id="J_Short_TeaQA">


                </div>
            </div>
        </div>*@


            </div>

        </div>

    </div>
    <!-- 模态框 -->
    <div class="modal fade" id="editGroup" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-top:200px;">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- 模态框头部 -->
                <div class="modal-header">
                    <h4 class="modal-title">教师打分</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- 模态框主体 -->
                <div class="modal-body">
                    <input id="txtScoreName" name="txtScoreName" class="form-control" style="width:99%;" maxlength="3" />
                </div>

                <!-- 模态框底部 -->
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>
                    <button id="btnEditGroup" type="button" class="btn btn-primary" onclick="SubmitScore_Click()">提交</button>
                </div>

            </div>
        </div>
    </div>

    <div class="modal fade" id="editPaperGroup" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-top:200px;">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- 模态框头部 -->
                <div class="modal-header">
                    <h4 class="modal-title">调整关注论文组</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- 模态框主体 -->
                <div class="modal-body">
                    <table>
                        <tr>
                            <td><select id="ddlPaperGroupId" name="ddlPaperGroupId" class="form-control" style="width:300px;" /></td>
                            <td><button type="button" class="btn btn-primary" onclick="SubmitPaperGroup_Click()">提交更改</button></td>
                        </tr>
                    </table>
                </div>

                <!-- 模态框底部 -->
                @*<div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">关闭</button>

                    </div>*@

            </div>
        </div>
    </div>

</div>

<input id="hidStuId" type="hidden" />

<input id="hidPaperGroupId" type="hidden" />

<input id="hidPaperAttentionId" type="hidden" />
<input id="hidType" type="hidden" value="2" />

@*- 存放tab页顺序 --*@
<input id="hidTabNum" type="hidden" />

<input id="hidid_CurrEduCls" type="hidden" />