
@page
@{
    Layout = "";
}
@section Styles{
    <link rel="stylesheet" href="../lib/bootstrap/dist/css/bootstrap.css" />
    <link rel="stylesheet" href="../css/site.css" />
}
@section Scripts{
    <script src="../lib/jquery/dist/jquery.js"></script>
    <script src="../lib/bootstrap/dist/js/bootstrap.js"></script>
    <script src="../js/site.js" asp-append-version="true"></script>
    <script src="../lib/bootstrap/dist/js/popper.js"></script>
    <script src="../lib/require/require.js" data-main="../js/src/config"></script>
}
<script>
    //所有用户自定义的JS函数建议都放在这里


</script>
<script>


    /*
     按钮单击,用于调用Js函数中btnEdit_Click
    (AutoGCLib.WA_ViewScript_Edit_TS4Html:Gen_WApi_JS_btnEdit_Click)
    */
    function btnEdit_Click(strCommandName, strKeyId) {
        //require(["../js/GraduateEduTopic/gs_PaperReport_EditEx.js"], function (gs_paperreport) {
        //    gs_paperreport.gs_PaperReport_EditEx.btnEdit_Click(strCommandName, strKeyId);
        //});
        if ($("#ddlPaperId").val() == 0) {
            layer.msg('主题相关论文必须要选择!', {
                icon: 3,
                time: 1000
            });
        } else if ($("#txtReportDate").val() == "") {
            layer.msg('汇报日期不能为空!', {
                icon: 3,
                time: 1000
            });
        }
        else if ($("#txtReportUser").val() == "") {
            layer.msg('汇报人员不能为空!', {
                icon: 3,
                time: 1000
            });
        }
        else {
                $("#divLoading").show();
                //防止重复提交
                $('#btnSubmit_gs_PaperReport').attr("disabled", true);
                IsFile(strCommandName, strKeyId);
            }
    }


    //判断附件格式、以及文件附件格式
    function IsFile(strCommandName, strKeyId) {
        var filePPT = $("#txtPPTUrl").val();

        if (filePPT != "") {
            strs = filePPT.split('.');
            var suffix = strs[strs.length - 1];

            if (suffix != 'ppt' && suffix != 'pptx') {
                alert("请选择ppt或者pptx格式！");
                var obj = document.getElementById('txtPPTUrl');
                obj.outerHTML = obj.outerHTML; //这样清空，在IE8下也能执行成功
                return;
                //obj.select(); document.selection.clear();这种方法也可以清空 input file 的value值
            }

        }

        var filePDF = $("#txtPDFUrl").val();

        if (filePDF != "") {
            strs = filePDF.split('.');
            var suffix = strs[strs.length - 1];

            if (suffix != 'pdf') {
                alert("请选择pdf格式！");
                var obj = document.getElementById('txtPDFUrl');
                obj.outerHTML = obj.outerHTML; //这样清空，在IE8下也能执行成功
                return;
                //obj.select(); document.selection.clear();这种方法也可以清空 input file 的value值
            }

        }



        //上传
        doUpload(strCommandName, strKeyId);


    }



        //上传方法
    function doUpload(strCommandName, strKeyId) {
        var formData = new FormData($("#uploadForm")[0]);
        $.ajax({
             url: "@Url.Action("UpLoadPaperReport", "testUploadPic")",
            type: 'post',
            data: formData,
            async: false,
            cache: false,
            contentType: false,
            processData: false,
            success: function (returndata) {
                //成功/为空
                if (returndata.status == 0 || returndata.status == -1) {

                    //如果图片地址为空，那么是修改 则不用存放地址；
                    if (returndata.fileNamePPT != "") {
                        $("#hidppt").val(returndata.fileNamePPT);
                    }
                    //如果文件地址为空，那么是修改 则不用存放地址；返回3个文件地址；
                    if (returndata.fileNamePDF != "") {
                        $("#hidpdf").val(returndata.fileNamePDF);
                    }

                    require(["../js/GraduateEduTopic/gs_PaperReport_EditEx.js"], function (gs_paperreport) {
                        gs_paperreport.gs_PaperReport_EditEx.btnEdit_Click(strCommandName, strKeyId);
                    });

                }
                else {

                    alert('请选择正确文件!(in gs_PaperReport_Edit.doUpload)')
                }


            },
            error: function (returndata) {
                alert(returndata);
            }
        });
    }
  
 /**
  显示对话框
 (AutoGCLib.WA_ViewScript_Edit_TS4Html:Gen_WApi_JS_ShowDialog)
 **/
function ShowDialog(strDialogName) {
   require(['jquery', 'bootstrap'], function($) {
 $(strDialogName).modal('show');
  });
}

 /**
  隐藏对话框
 (AutoGCLib.WA_ViewScript_Edit_TS4Html:Gen_WApi_JS_HideDialog)
 **/
function HideDialog(strDialogName) {
  require(['jquery', 'bootstrap'], function($) {
      $(strDialogName).modal('hide');
  });
}
</script>
<div id="divEditLayout" class="tab_layout">
    @*-- 编辑层 --*@

    <div class="modal fade" id="divEditDialog_gs_PaperReport" tabindex="-1" role="dialog" aria-labelledby="lblDialogTitle_gs_PaperReport" aria-hidden="true">
        <div class="modal-dialog">
            <form id="uploadForm" method="post" enctype="multipart/form-data">
                <div class="modal-content" style="width: 735px;">
                    <div class="modal-header">
                        <h4 class="modal-title" id="lblDialogTitle_gs_PaperReport">模态框（Modal）标题</h4>
                        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    </div>
                    <div class="modal-body">
                        <table id="tabEdit" style="width:700px" class="table table-bordered table-hover table td table-sm">
                            <tr id="trUpdDate" style="display:none;">
                                <td class="text-right">
                                    <Label id="lblReportId" name="lblReportId" class="col-form-label text-right" style="width:90px;">
                                        汇报Id
                                    </Label>
                                </td>
                                <td class="text-left">
                                    <input id="txtReportId" name="txtReportId" class="form-control" style="width:150px;" />
                                </td>
                                <td class="text-right">
                                    <Label id="lblUpdDate" name="lblUpdDate" class="col-form-label text-right" style="width:90px;">
                                        修改日期
                                    </Label>
                                </td>
                                <td class="text-left">
                                    <input id="txtUpdDate" name="txtUpdDate" class="form-control" style="width:150px;" />
                                </td>
                            </tr>

                            <tr id="trReportContent">
                                <td class="text-left" colspan="2">
                                    @*<select id="ddlPaperId" name="ddlPaperId" class="form-control" style="width:150px;"></select>*@
                                    <select id="ddlPaperId" name="ddlPaperId" class="form-control" style="width:400px;" />
                                </td>
                            </tr>
                            <tr id="trPaperId">
                                <td class="text-left" colspan="2">
                                    <textarea id="txtReportContent" name="txtReportContent" placeholder="请输入汇报内容" class="form-control" style="width:100%;height:200px;" />

                                </td>
                            </tr>
                            <tr id="trReportDate">
                                <td class="text-left">
                                    <input id="txtReportDate" name="txtReportDate" placeholder="请输入汇报日期" class="form-control" style="width:150px;" />
                                </td>
                                <td class="text-left">
                                    <input id="txtReportUser" name="txtReportUser" placeholder="请输入汇报人员" class="form-control" style="width:300px;" />
                                </td>
                            </tr>
                            <tr id="trPPTUrl">
                                <td class="text-left" colspan="2">
                                    <Label id="lblPPTUrl" name="lblPPTUrl" class="col-form-label text-right" style="width:60px; float:left">
                                        PPT：
                                    </Label>
                                    <input type="file" id="txtPPTUrl" name="txtPPTUrl" placeholder="请上传PPT文件" class="form-control" style="width:250px;" />
                                </td>
                            </tr>
                            <tr id="trPDFUrl">
                                <td class="text-left" colspan="2">
                                    <Label id="lblPDFUrl" name="lblPDFUrl" class="col-form-label text-right" style="width:60px; float:left">
                                        PDF：
                                    </Label><input type="file" id="txtPDFUrl" name="txtPDFUrl" class="form-control" style="width:250px;" />
                                </td>
                            </tr>
                            <tr id="trMemo">
                                <td class="text-left" colspan="2">
                                    <input id="txtMemo" name="txtMemo" placeholder="备注" class="form-control" style="width:100%;" />
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button id="btnCancel_gs_PaperReport" type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                        <button id="btnSubmit_gs_PaperReport" type="button" class="btn btn-primary" onclick="btnEdit_Click('Submit')">添加</button>
                    </div>
                </div>
            </form>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal -->
    </div>
</div>